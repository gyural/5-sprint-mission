package com.sprint.mission;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.ConfigurableApplicationContext;

import com.sprint.mission.discodeit.entity.Channel;
import com.sprint.mission.discodeit.entity.ChannelType;
import com.sprint.mission.discodeit.entity.Message;
import com.sprint.mission.discodeit.entity.User;
import com.sprint.mission.discodeit.repository.file.FileChannelRepository;
import com.sprint.mission.discodeit.repository.file.FileMessageRepository;
import com.sprint.mission.discodeit.repository.file.FileUserRepository;
import com.sprint.mission.discodeit.service.ChannelService;
import com.sprint.mission.discodeit.service.MessageService;
import com.sprint.mission.discodeit.service.UserService;
import com.sprint.mission.discodeit.service.basic.BasicChannelService;
import com.sprint.mission.discodeit.service.basic.BasicMessageService;
import com.sprint.mission.discodeit.service.basic.BasicUserService;

@SpringBootApplication
public class DiscodeitApplication {
	static User setupUser(UserService userService) {
		User user = userService.create("woody", "woody@codeit.com", "woody1234");
		return user;
	}

	static Channel setupChannel(ChannelService channelService) {
		Channel channel = channelService.create(ChannelType.PUBLIC, "ê³µì§€", "ê³µì§€ ì±„ë„ì…ë‹ˆë‹¤.");
		return channel;
	}

	static Message setupMessage(MessageService messageService, Channel channel, User author) {
		Message message = messageService.create("ì•ˆë…•í•˜ì„¸ìš”.", channel.getId(), author.getId());
		return message;
	}

	static void channelCreateTest(ChannelService channelService) {
		System.out.print("ChannelCreateTest.......................");
		Channel channel = channelService.create(ChannelType.PUBLIC, "ê³µì§€", "ê³µì§€ ì±„ë„ì…ë‹ˆë‹¤.");

		boolean isCreated = !channelService.isEmpty(channel.getId());

		System.out.println(isCreated ?
		  "ì±„ë„ ìƒì„± í…ŒìŠ¤íŠ¸ í†µê³¼ âœ…" :
		  "ì±„ë„ ìƒì„± í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ âŒ");
	}

	static void channelReadTest(ChannelService channelService, Channel channel) {
		System.out.print("channelReadTest.......................");
		Channel readChannel = channelService.read(channel.getId());

		boolean isValid = readChannel.getId().equals(channel.getId()) &&
		  readChannel.getName().equals(channel.getName()) &&
		  readChannel.getDescription().equals(channel.getDescription());

		System.out.println(isValid ?
		  "ì±„ë„ ì¡°íšŒ í…ŒìŠ¤íŠ¸ í†µê³¼ âœ…" :
		  "ì±„ë„ ì¡°íšŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ âŒ");
	}

	static void channelUpdateTest(ChannelService channelService, Channel channel) {
		System.out.print("channelUpdateTest.......................");

		String newName = "ì—…ë°ì´íŠ¸ëœ ì±„ë„";
		String newDescription = "ì—…ë°ì´íŠ¸ëœ ì±„ë„ ì„¤ëª…";

		channelService.update(channel.getId(), channel.getChannelType(), newName, newDescription);

		Channel channelToValidate = channelService.read(channel.getId());
		boolean isUpdated = channelToValidate.getName().equals(newName) &&
		  channelToValidate.getDescription().equals(newDescription);

		System.out.println(isUpdated ?
		  "ì±„ë„ ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸ í†µê³¼ âœ…" :
		  "ì±„ë„ ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ âŒ");
	}

	static void channelDeleteTest(ChannelService channelService, Channel channel) {
		System.out.print("channelDeleteTest.......................");

		channelService.delete(channel.getId());
		String log = channelService.isEmpty(channel.getId()) ?
		  "ì±„ë„ì´ ì‚­ì œ í…ŒìŠ¤íŠ¸ í†µê³¼ âœ…" :
		  "ì±„ë„ì´ ì‚­ì œ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ âŒ";
		System.out.println(log);
	}

	static void userCreateTest(UserService userService) {
		System.out.print("UserCreateTest.......................");
		User user = userService.create("newUser", "newUser@codeit.com", "newUser1234");

		boolean isCreated = userService.read(user.getId()) != null;

		System.out.println(isCreated ?
		  "ì‚¬ìš©ì ìƒì„± í…ŒìŠ¤íŠ¸ í†µê³¼ âœ…" :
		  "ì‚¬ìš©ì ìƒì„± í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ âŒ");
	}

	static void userReadTest(UserService userService, User user) {
		System.out.print("UserReadTest.......................");
		User readUser = userService.read(user.getId());

		boolean isValid = readUser.getId().equals(user.getId()) &&
		  readUser.getUsername().equals(user.getUsername()) &&
		  readUser.getEmail().equals(user.getEmail());

		System.out.println(isValid ?
		  "ì‚¬ìš©ì ì¡°íšŒ í…ŒìŠ¤íŠ¸ í†µê³¼ âœ…" :
		  "ì‚¬ìš©ì ì¡°íšŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ âŒ");
	}

	static void userUpdateTest(UserService userService, User user) {
		System.out.print("UserUpdateTest.......................");

		String newUsername = "updatedUser";
		String newEmail = "updateEmail@codeit.com";
		String newPassword = "updatedPassword1234";

		userService.update(user.getId(), newUsername, newEmail, newPassword);

		User userToValidate = userService.read(user.getId());
		boolean isUpdated = userToValidate.getUsername().equals(newUsername) &&
		  userToValidate.getEmail().equals(newEmail);

		System.out.println(isUpdated ?
		  "ì‚¬ìš©ì ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸ í†µê³¼ âœ…" :
		  "ì‚¬ìš©ì ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ âŒ");

	}

	static void userDeleteTest(UserService userService, User user) {
		System.out.print("UserDeleteTest.......................");

		userService.delete(user.getId());

		String log = userService.isEmpty(user.getId()) ?
		  "ì‚¬ìš©ì ì‚­ì œ í…ŒìŠ¤íŠ¸ í†µê³¼ âœ…" :
		  "ì‚¬ìš©ì ì‚­ì œ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ âŒ";
		System.out.println(log);
	}

	static void messageCreateTest(MessageService messageService, Channel channel, User author) {
		System.out.print("MessageCreateTest.......................");
		Message message = messageService.create("ì•ˆë…•í•˜ì„¸ìš”.", channel.getId(), author.getId());

		Message storedMessage = messageService.read(message.getId());

		boolean isCreated = messageService.read(message.getId()) != null &&
		  storedMessage.getContent().equals("ì•ˆë…•í•˜ì„¸ìš”.") &&
		  storedMessage.getChannelId().equals(channel.getId()) &&
		  storedMessage.getAuthorId().equals(author.getId());

		System.out.println(isCreated ?
		  "ë©”ì‹œì§€ ìƒì„± í…ŒìŠ¤íŠ¸ í†µê³¼ âœ…" :
		  "ë©”ì‹œì§€ ìƒì„± í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ âŒ");
	}

	static void messageReadTest(MessageService messageService, Message message) {
		System.out.print("MessageReadTest.......................");
		Message readMessage = messageService.read(message.getId());

		boolean isValid = readMessage.getId().equals(message.getId()) &&
		  readMessage.getContent().equals(message.getContent()) &&
		  readMessage.getChannelId().equals(message.getChannelId()) &&
		  readMessage.getAuthorId().equals(message.getAuthorId());

		System.out.println(isValid ?
		  "ë©”ì‹œì§€ ì¡°íšŒ í…ŒìŠ¤íŠ¸ í†µê³¼ âœ…" :
		  "ë©”ì‹œì§€ ì¡°íšŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ âŒ");
	}

	static void messageUpdateTest(MessageService messageService, Message message) {
		System.out.print("MessageUpdateTest.......................");

		String newContent = "ì—…ë°ì´íŠ¸ëœ ë©”ì‹œì§€ ë‚´ìš©";
		messageService.update(message.getId(), newContent);

		Message updatedMessage = messageService.read(message.getId());
		boolean isUpdated = updatedMessage.getContent().equals(newContent);

		System.out.println(isUpdated ?
		  "ë©”ì‹œì§€ ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸ í†µê³¼ âœ…" :
		  "ë©”ì‹œì§€ ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ âŒ");
	}

	static void messageDeleteTest(MessageService messageService, Message message) {
		System.out.print("MessageDeleteTest.......................");

		messageService.delete(message.getId());

		String log = messageService.isEmpty(message.getId()) ?
		  "ë©”ì‹œì§€ ì‚­ì œ í…ŒìŠ¤íŠ¸ í†µê³¼ âœ…" :
		  "ë©”ì‹œì§€ ì‚­ì œ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ âŒ";
		System.out.println(log);
	}

	static void clearAll(ChannelService channelService, UserService userService, MessageService messageService) {
		channelService.deleteAll();
		userService.deleteAll();
		messageService.deleteAll();
	}

	public static void main(String[] args) {
		ConfigurableApplicationContext context = SpringApplication.run(DiscodeitApplication.class, args);

		// setup-1 FILE ë ˆí¬ì§€í† ë¦¬ ì´ˆê¸°í™”
		FileUserRepository fileUserRepository = context.getBean(FileUserRepository.class);
		FileChannelRepository fileChannelRepository = context.getBean(FileChannelRepository.class);
		FileMessageRepository fileMessageRepository = context.getBean(FileMessageRepository.class);
		// setup-2 Basic ì„œë¹„ìŠ¤ ì´ˆê¸°í™”
		UserService BasicUserService = new BasicUserService(fileUserRepository);
		MessageService BasicMessageService = new BasicMessageService(fileMessageRepository, BasicUserService,
		  fileChannelRepository);
		ChannelService BasicChannelService = new BasicChannelService(fileChannelRepository, fileMessageRepository);

		System.out.println("\n" +
		  "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n" +
		  "ğŸ’¾ [FILE] ì €ì¥ì†Œ ê¸°ë°˜ BasicService í…ŒìŠ¤íŠ¸ ì‹œì‘\n" +
		  "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");

		// ğŸ’¥ğŸ’¥ğŸ’¥ Channel Test Start ğŸ’¥ğŸ’¥ğŸ’¥
		System.out.println("\n" +
		  "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“\n" +
		  "â”ƒ     ğŸ“¡ CHANNEL TEST           â”ƒ\n" +
		  "â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›");

		Channel fileChannelforBasic = setupChannel(BasicChannelService);
		channelCreateTest(BasicChannelService);
		channelReadTest(BasicChannelService, fileChannelforBasic);
		channelUpdateTest(BasicChannelService, fileChannelforBasic);
		channelDeleteTest(BasicChannelService, fileChannelforBasic);

		System.out.println("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“\n" +
		  "â”ƒ âœ… END CHANNEL TEST           â”ƒ\n" +
		  "â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›");
		clearAll(BasicChannelService, BasicUserService, BasicMessageService);

		// ğŸ§‘â€ğŸ’»ğŸ§‘â€ğŸ’»ğŸ§‘â€ğŸ’» User Test Start ğŸ§‘â€ğŸ’»ğŸ§‘â€ğŸ’»ğŸ§‘â€ğŸ’»
		System.out.println("\n" +
		  "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“\n" +
		  "â”ƒ       ğŸ™‹ USER TEST            â”ƒ\n" +
		  "â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›");

		User fileUserforBasic = setupUser(BasicUserService);
		userCreateTest(BasicUserService);
		userReadTest(BasicUserService, fileUserforBasic);
		userUpdateTest(BasicUserService, fileUserforBasic);
		userDeleteTest(BasicUserService, fileUserforBasic);

		System.out.println("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“\n" +
		  "â”ƒ âœ… END USER TEST              â”ƒ\n" +
		  "â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›");
		clearAll(BasicChannelService, BasicUserService, BasicMessageService);

		// ğŸ’ŒğŸ’ŒğŸ’Œ Message Test Start ğŸ’ŒğŸ’ŒğŸ’Œ
		System.out.println("\n" +
		  "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“\n" +
		  "â”ƒ     ğŸ’Œ MESSAGE TEST           â”ƒ\n" +
		  "â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›");

		Channel fileChannelForMessageforBasic = setupChannel(BasicChannelService);
		User fileUserForMessageforBasic = setupUser(BasicUserService);
		Message fileMessageforBasic = setupMessage(BasicMessageService, fileChannelForMessageforBasic,
		  fileUserForMessageforBasic);

		messageCreateTest(BasicMessageService, fileChannelForMessageforBasic, fileUserForMessageforBasic);
		messageReadTest(BasicMessageService, fileMessageforBasic);
		messageUpdateTest(BasicMessageService, fileMessageforBasic);
		messageDeleteTest(BasicMessageService, fileMessageforBasic);

		System.out.println("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“\n" +
		  "â”ƒ âœ… END MESSAGE TEST           â”ƒ\n" +
		  "â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›");
		clearAll(BasicChannelService, BasicUserService, BasicMessageService);

	}
}
